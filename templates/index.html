<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>股票分析</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="container">
    <h1 class="mt-4">股票分析</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <form method="POST" action="{{ url_for('index') }}" class="mb-4">
        <div class="form-group">
            <input type="text" name="symbol" value="{{ symbol_input }}" class="form-control" placeholder="輸入股票代號">
        </div>
        <button type="submit" class="btn btn-primary">查詢</button>
    </form>
    {% if result.error %}
        <div class="alert alert-danger">{{ result.error }}</div>
    {% elif result.symbol %}
        <h3>{{ result.symbol }} - {{ result.profile.name }}</h3>
        <p>產業: {{ result.industry_zh }}</p>
        <a href="{{ url_for('stock_details', symbol=result.symbol) }}" class="btn btn-info">查看詳情</a>
        <div>{{ result.plot_html | safe }}</div>
    {% endif %}
    <h4 class="mt-4">訂閱方案</h4>
    <div class="row">
        {% for tier in tiers %}
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">{{ tier.name }}</h5>
                        <p class="card-text">每月請求上限: {{ tier.limit }}</p>
                        <p class="card-text">價格: ${{ tier.price }}</p>
                        <form method="POST" action="{{ url_for('create_checkout_session') }}">
                            <input type="hidden" name="tier" value="{{ tier.name }}">
                            <button type="submit" class="btn btn-success">選擇</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stripe/stripe-js@1.54.0/dist/stripe.min.js"></script>
</body>
</html>
